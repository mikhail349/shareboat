$(document).ready(()=>{$("img.avatar").on("click",()=>{$("input[name=avatar]").trigger("click")});const a=$("img.avatar").attr("src");var b=a.replace(/^.*[\\\/]/,"");$("input[name=avatar]").on("change",a=>{if(a.target.files&&a.target.files[0]){var c=new FileReader;c.onload=a=>{$("img.avatar").attr("src",a.target.result),$("img.avatar").attr("data-do-save","true")},b=a.target.files[0].name,c.readAsDataURL(a.target.files[0])}}),$("#btnSendConfirmation").on("click",a=>{a.preventDefault();const b=$("#formProfile input[name=email]").val();$.ajax({type:"POST",url:"/user/api/send_verification_email/",success:function(){showInfoToast(`Письмо с подтверждением отправлено на почту ${b}`)},error:function(a){showErrorToast(a.responseJSON.message)}})}),$("#formProfile").on("submit",async a=>{function c(){hideOverlayPanel(),showSuccessToast();const a=$("input[name=first_name]").val(),b=$("#formProfile input[name=email]").val();$("#userNameNavBar").text(a||b)}function d(a){hideOverlayPanel(),showErrorToast(a.responseJSON.message)}a.preventDefault();const e=$("#formProfile");if(e.checkValidity()){const a=new FormData(e[0]);if($("img.avatar")[0].hasAttribute("data-do-save")){let c=await fetch($("img.avatar").attr("src")),d=await c.blob();a.set("avatar",d,b)}showOverlayPanel(),$.ajax({type:"POST",data:a,url:"/user/api/update/",processData:!1,contentType:!1,success:c,error:d})}})});