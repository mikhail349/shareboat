$(document).ready(()=>{function a(){const a=new Date;var c=nextVerificationEmailDatetime.getTime()-a.getTime(),d=Math.round(c/1e3);if(0>=d)return clearInterval(b),$("#alertEmailNotConfirmed span").text("\u0412\u0430\u0448\u0430 \u043F\u043E\u0447\u0442\u0430 \u043F\u043E\u043A\u0430 \u0435\u0449\u0451 \u043D\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0430."),void $("#btnSendConfirmation").show();const e=Math.floor(d/3600),f=Math.floor((d-3600*e)/60),g=d-3600*e-60*f;let h="";0<e&&(h+=`${e} ч.`),0<f&&(h+=` ${f} мин.`),0<g&&(h+=` ${g} сек.`),h=h.trim(),$("#alertEmailNotConfirmed span").html(`Письмо отправлено на почту. Повторная отправка возможна через <span style='word-wrap:break-word; display:inline-block;' >${h}</span>`)}var b=null;$("#alertEmailNotConfirmed").length&&(a(),b=setInterval(a,1e3)),$("img.avatar").on("click",()=>{$("input[name=avatar]").trigger("click")});const c=$("img.avatar").attr("src");var d=c.replace(/^.*[\\\/]/,"");$("input[name=avatar]").on("change",a=>{if(a.target.files&&a.target.files[0]){var b=new FileReader;b.onload=a=>{$("img.avatar").attr("src",a.target.result),$("img.avatar").attr("data-do-save","true")},d=a.target.files[0].name,b.readAsDataURL(a.target.files[0])}}),$("#btnSendConfirmation").on("click",c=>{c.preventDefault(),$("#btnSendConfirmation").hide(),$.ajax({type:"POST",url:"/user/api/send_verification_email/",success:function(c){nextVerificationEmailDatetime=new Date(c.next_verification_email_datetime),a(),b=setInterval(a,1e3)},error:function(a){showErrorToast(a.responseJSON.message),$("#btnSendConfirmation").show()}})}),$("#formProfile").on("submit",async a=>{a.preventDefault();const b=$("#formProfile");if(!b.checkValidity())return;const c=new FormData(b[0]),e=$("img.avatar").attr("src"),f=$("img.avatar")[0].hasAttribute("data-do-save");if(f){let a=await fetch(e),b=await a.blob();c.set("avatar",b,d)}showOverlayPanel(),$.ajax({type:"POST",data:c,url:"/user/api/update/",processData:!1,contentType:!1,success:function(){hideOverlayPanel(),showSuccessToast();const a=$("input[name=first_name]").val(),b=$("#formProfile input[name=email]").val();$("#navbarDropdownUserProfile span").text(a||b),f&&($("#navbarDropdownUserProfile img").length?$("#navbarDropdownUserProfile img").attr("src",e):$("#navbarDropdownUserProfile").prepend("<img class=\"d-inline-block align-top nav-bar-avatar rounded-circle mx-2\" src=\""+e+"\" />"))},error:function(a){hideOverlayPanel(),showErrorToast(a.responseJSON.message)}})})});