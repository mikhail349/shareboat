$(document).ready(()=>{function a(){$(window).scrollTop()>=$(document).height()-$(window).height()-700&&b()}function b(){function a(a){c(!1),a?.has_next_page?e+=1:g=!1;for(let b of a?.messages)d(b)}function b(){c(!1)}f||!g||(c(!0),$.ajax({type:"GET",url:"/chat/api/ajax_list/",data:{page:e},success:a,error:b}))}function c(a){f=a,a?h.append(`
                <div id="isLoadingItem" class="list-group-item text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            `):$("#isLoadingItem").remove()}function d(a){function b(){return a?.sender?.avatar_sm?`<img height="32" width="32" src="${a.sender.avatar_sm}" class="rounded-circle of-cover">`:null===a?.sender?`<img height="32" width="32" src="${window.systemImgURL}" class="rounded-circle of-cover">`:"<div style=\"width:32px; height:32px; min-width: 32px !important; min-height: 32px;\"></div>"}function c(){return formatDateTime(new Date(a.sent_at),"dd mmms yyyy, HH:MM")}function d(){return a.read||a?.recipient?.id!==window.myId?"":`<span class="position-absolute translate-middle-y top-50 start-m14 p-1 bg-danger border border-light rounded-circle" title="Новое сообщение"></span>`}function e(){return a?.sender?a?.sender.id===window.myId?"\u0412\u044B: ":`${a?.sender?.first_name}: `:""}h.append(`
            <a class="list-group-item py-3" href="${a.get_href}?back=${window.location.pathname}">
                <div class="d-flex gap-3">
                    ${b()}
                    <div class="w-100">
                        <div>
                            <div class="col float-end text-muted position-relative">
                                ${c()} 
                                ${d()}
                            </div>
                            <div class="fw-bold">${a?.get_title}</div>
                        </div>
                        <div>
                            <div class="col float-end">
                                ${a?.badge}
                            </div>   
                            <div class="mb-0 text-muted" style="max-height: 150px;">
                                ${e()}
                                ${a?.text}
                            </div>                   
                        </div>                
                    </div>
                </div>
            </a>
        `)}var e=1,f=!1,g=!0;const h=$(".chat-list");a(),$(window).scroll(a),$(window).on("resize",a)});