$(document).ready(()=>{function a(a){return a?.sender?.avatar?`
                <img
                    height="32"
                    width="32"
                    src="${a.sender.avatar}" 
                    class="rounded-circle"
                    alt 
                />
            `:"<div style=\"width:32px; height:32px\"></div>"}function b(b){const c=b.is_out?"list-group-item-primary ":"list-group-item-secondary ";h.append(`
            <div class="list-group-item ${c} mb-3 rounded border d-flex gap-3" style="width: fit-content;">
                `+a(b)+`
                <div class="d-flex">
                    ${b.text.replaceAll("\r\n","<br>")}
                </div>
            </div>  
        `)}function c(){return g.val()}function d(){function a(a){g.val(null),b(a.data)}function d(a){console.log("onError",a),showErrorToast(a.responseJSON.message)}const e=c();if(e){const b=new FormData;b.append("text",e),b.append("booking_id",window.bookingId),$.ajax({type:"POST",url:`/chat/api/send_message_booking/`,data:b,processData:!1,contentType:!1,success:a,error:d})}}// Long polling
function e(){$.ajax({type:"GET",url:`/chat/api/get_new_messages_booking/${window.bookingId}/`}).done(function(a){if(console.log(a.data),0<a?.data?.length)for(let c of a.data)b(c);e()}).fail(function(a){0==a.status&&e()})}var f=$("#btnSendMessage"),g=$("#textArea"),h=$("#msgContainer");if(0<window.messages.length)for(var i of window.messages)b(i);g.on("input",function(){const a=c();f.attr("disabled",!a)}),f.on("click",function(){d()}),e()});