var isOnBottom=!1;$(document).ready(()=>{function a(a){return a?.sender?.avatar?`
                <img
                    height="32"
                    width="32"
                    src="${a.sender.avatar}" 
                    class="rounded-circle"
                    alt 
                />
            `:"<div style=\"width:32px; height:32px\"></div>"}function b(b){const c=b.is_out?"list-group-item-primary ":"list-group-item-secondary ";l.append(`
            <div class="list-group-item ${c} mb-3 rounded border d-flex gap-3" style="width: fit-content;">
                `+a(b)+`
                <div class="d-flex">
                    ${b.text.replaceAll("\r\n","<br>")}
                </div>
            </div>  
        `)}function c(){return k.val()}function d(){function a(a){k.val(null),b(a.data),$("html, body").animate({scrollTop:$(document).height()})}function d(a){console.log("onError",a),showErrorToast(a.responseJSON.message)}const e=c();if(e){const b=new FormData;b.append("text",e),b.append("booking_id",window.bookingId),$.ajax({type:"POST",url:`/chat/api/send_message_booking/`,data:b,processData:!1,contentType:!1,success:a,error:d})}}// Long polling
function e(){$.ajax({type:"GET",url:`/chat/api/get_new_messages_booking/${window.bookingId}/`}).done(function(a){if(console.log(a.data),0<a?.data?.length){for(let c of a.data)b(c);isOnBottom&&$("html, body").animate({scrollTop:$(document).height()})}e()}).fail(function(a){0==a.status&&e()})}/*window.removeEventListener('scroll', mainMenuHide, false);
    window.addEventListener("scroll", function () {
        var st = window.pageYOffset || document.documentElement.scrollTop;
        if (st > lastScrollTop && st > 180){
            $('body > header > nav').css("top", "-80px");
            $('.scroll-hiding').attr('style', `top: -${($('.scroll-hiding').outerHeight() + 62)}px !important;`);
        } else {
            $('body > header > nav').css("top", "0");
            $('.scroll-hiding').attr('style', `top: 62px !important;`);
        }
        lastScrollTop = st <= 0 ? 0 : st;
    }, false);*/let f=0,g=62;const h=$("#bookingData"),i=h.outerHeight();window.addEventListener("scroll",function(){const a=window.pageYOffset||document.documentElement.scrollTop,b=a-f;g+=-b,g=g<-i?-i:62<g?62:g,h.attr("style",`top: ${g}px !important;`),f=a},!1);var j=$("#btnSendMessage"),k=$("#textArea"),l=$("#msgContainer");if(0<window.messages.length){for(var m of window.messages)b(m);$("html, body").scrollTop($(document).height())}k.on("input",function(){const a=c();j.attr("disabled",!a)}),j.on("click",function(){d()}),e(),$(window).scroll(function(){isOnBottom=$(window).scrollTop()+$(window).height()==$(document).height()})});