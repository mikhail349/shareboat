var isOnBottom=!1;$(document).ready(()=>{function a(a){return a?.sender?.avatar?`
                <img
                    height="32"
                    width="32"
                    src="${a.sender.avatar}" 
                    class="rounded-circle chat-avatar"
                    alt 
                />
            `:"<div style=\"width:32px; height:32px; min-width: 32px !important; min-height: 32px;\"></div>"}function b(a){return`${("0"+a.getDate()).slice(-2)}.${("0"+(a.getMonth()+1)).slice(-2)}.${a.getFullYear()}, ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}`}function c(c){const d=c.is_out?"bg-primary ":"bg-secondary ";return`
            <div id="msg${c.id}" class="list-group-item border-0" style="width: fit-content;">
                <div class="d-flex gap-3">
                    `+a(c)+`
                    <div class="d-flex ${d} text-white rounded p-1 px-2" style="font-size: 18px; height: fit-content">${c.text.replaceAll("\r\n","<br>")}</div>
                    <small class="float-end pe-1 align-self-end" style="font-size: 12px;">${b(new Date(c.sent_at))}</small>
                </div>
            </div>  
        `}function d(a){window.lastMessageId=a.id,o.append(c(a))}function e(a){o.prepend(c(a))}function f(){return n.val()}function g(){function a(a){n.val(null),d(a.data),$("html, body").animate({scrollTop:$(document).height()})}function b(a){console.log("onError",a),showErrorToast(a.responseJSON.message)}const c=f();if(c){const d=new FormData;d.append("text",c),d.append("booking_id",window.bookingId),$.ajax({type:"POST",url:`/chat/api/send_message_booking/`,data:d,processData:!1,contentType:!1,success:a,error:b})}}// Long polling
function h(){$.ajax({type:"GET",url:`/chat/api/get_new_messages_booking/${window.bookingId}?last_message_id=${window.lastMessageId}`}).done(function(a){if(0<a?.data?.length){for(let b of a.data)d(b);isOnBottom&&$("html, body").animate({scrollTop:$(document).height()})}h()}).fail(function(a){0==a.status&&h()})}let i=0,j=62;const k=$("#bookingData"),l=k.outerHeight();window.addEventListener("scroll",function(){const a=window.pageYOffset||document.documentElement.scrollTop,b=a-i;j+=-b,j=j<-l?-l:62<j?62:j,k.attr("style",`top: ${j}px !important;`),i=a},!1);var m=$("#btnSendMessage"),n=$("#textArea"),o=$("#msgContainer");if(0<window.messages.length){for(var p of window.messages)d(p);$("html, body").scrollTop($(document).height())}n.on("input",function(){const a=f();m.attr("disabled",!a)}),n.on("keydown",function(a){13===a.keyCode&&a.preventDefault()}),n.on("keyup",function(a){13===a.keyCode&&(a.preventDefault(),g())}),m.on("click",function(){g()}),$("#btnLoadPreviousPage").on("click",function(){const a=window.messagesPage-1;1==a&&$(this).remove(),$.ajax({type:"GET",url:`/chat/api/get_messages_booking/${window.bookingId}?page_num=${a}`}).done(function(b){if(0<b?.data?.length){const a=b.data.reverse();for(let b of a)e(b);$("html, body").scrollTop($(`#msg${a[0].id}`).offset().top-10)}window.messagesPage=a})}),h(),$(window).scroll(function(){isOnBottom=$(window).scrollTop()+$(window).height()==$(document).height()})});