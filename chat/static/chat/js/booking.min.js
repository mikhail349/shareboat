var isOnBottom=!1;$(document).ready(()=>{function a(a){return a?.sender?.avatar?`
                <img
                    height="32"
                    width="32"
                    src="${a.sender.avatar}" 
                    class="rounded-circle"
                    alt 
                />
            `:"<div style=\"width:32px; height:32px\"></div>"}function b(a){const b=a.getDate(),c=a.getMonth()+1;return`${(9<b?"":"0")+b}.${(9<c?"":"0")+c}.${a.getFullYear()}, ${a.getHours()}:${a.getMinutes()}`}function c(c){const d=c.is_out?"list-group-item-primary ":"list-group-item-secondary ";m.append(`
            <div class="list-group-item ${d} mb-3 rounded border pb-0" style="width: fit-content;">
                <div class="d-flex gap-3">
                    `+a(c)+`
                    <div class="d-flex">
                        ${c.text.replaceAll("\r\n","<br>")}
                    </div>
                </div>
                <small class="float-end">${b(new Date(c.sent_at))}</small>
            </div>  
        `)}function d(){return l.val()}function e(){function a(a){l.val(null),c(a.data),$("html, body").animate({scrollTop:$(document).height()})}function b(a){console.log("onError",a),showErrorToast(a.responseJSON.message)}const e=d();if(e){const c=new FormData;c.append("text",e),c.append("booking_id",window.bookingId),$.ajax({type:"POST",url:`/chat/api/send_message_booking/`,data:c,processData:!1,contentType:!1,success:a,error:b})}}// Long polling
function f(){$.ajax({type:"GET",url:`/chat/api/get_new_messages_booking/${window.bookingId}/`}).done(function(a){if(console.log(a.data),0<a?.data?.length){for(let b of a.data)c(b);isOnBottom&&$("html, body").animate({scrollTop:$(document).height()})}f()}).fail(function(a){0==a.status&&f()})}let g=0,h=62;const i=$("#bookingData"),j=i.outerHeight();window.addEventListener("scroll",function(){const a=window.pageYOffset||document.documentElement.scrollTop,b=a-g;h+=-b,h=h<-j?-j:62<h?62:h,i.attr("style",`top: ${h}px !important;`),g=a},!1);var k=$("#btnSendMessage"),l=$("#textArea"),m=$("#msgContainer");if(0<window.messages.length){for(var n of window.messages)c(n);$("html, body").scrollTop($(document).height())}l.on("input",function(){const a=d();k.attr("disabled",!a)}),k.on("click",function(){e()}),f(),$(window).scroll(function(){isOnBottom=$(window).scrollTop()+$(window).height()==$(document).height()})});