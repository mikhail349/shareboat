function onAfterPopupClosed(a,b){a.close(),$("select[name=\"term\"]").append(new Option(text=b.name,value=b.pk,defaultSelected=!0,selected=!0))}$(document).ready(()=>{function a(a){d?.removeLayer(f),f=new L.marker(a,{draggable:!0,icon:window.markerIcon}).on("dragend",function(a){c(a.target.getLatLng())}),d&&f?.addTo(d)}function b(b){function e(b){if(0==b.length)return showErrorToast("\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E");const e=b[0];var f={lat:e.lat,lng:e.lon};d.setView(f),a(f),c(f)}null!=j&&(j.abort(),j=null),j=$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/?q=${b}&format=json&accept-language=ru`,success:e})}function c(a){function b(){$("form button[type=submit").attr("disabled",!1),d?.removeLayer(f),f=null}null!=k&&(k.abort(),k=null),$("form button[type=submit").attr("disabled",!0),$(".addressLabel").text("\u0418\u0434\u0435\u0442 \u043F\u043E\u0438\u0441\u043A..."),$(".addressLabel").removeClass("text-primary"),k=$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/reverse?lat=${a.lat}&lon=${a.lng}&format=json&accept-language=ru`,success:function(a){a.display_name&&($(".addressLabel").text(a.display_name),$(".addressLabel").addClass("text-primary"),window.boatCoordinates.address=a.display_name,window.boatCoordinates.state=a?.address?.state,$("form button[type=submit").attr("disabled",!1))},error:b})}var d,f={};const g=$("#manufacturerSelect"),h=$("#modelSelect");if(g.on("change",function(){h.html("<option selected disabled value=\"\">\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430</option>");const a=parseInt($("#manufacturerSelect option:selected").val());isNaN(a)||$.ajax({type:"GET",url:`/boats/api/get_models/${a}/`,success:a=>{for(let b of a.data)h.append(`
                        <option value="${b.id}">${b.name}</option>
                    `)}})}),$("#typeSelect").on("change",()=>{const a=parseInt($("#typeSelect option:selected").val()),b=$("#collapseMotorBoat"),c=b.find("fieldset");window.motorBoatTypes.includes(a)?(b.collapse("show"),c.removeAttr("disabled")):(b.collapse("hide"),c.attr("disabled",""));const d=$("#collapseComfortBoat"),e=d.find("fieldset");window.comfortBoatTypes.includes(a)?(d.collapse("show"),e.removeAttr("disabled")):(d.collapse("hide"),e.attr("disabled",""))}),$("form").on("submit",async a=>{a.preventDefault();const b=$("form");if(!b.checkValidity())return;if($("#switchCustomLocation").is(":checked")&&$.isEmptyObject(f))return void showErrorToast("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441");showOverlayPanel();const c=new FormData(b[0]),d=$(".file-upload-wrapper img.card-img");for(let b of d){const a=$(b),d=a.attr("src"),e=a.attr("data-filename"),f=await fetch(d),g=await f.blob();e?c.append("file",g,e):c.append("file",g)}if(c.append("prices",JSON.stringify(window.prices)),$("#switchCustomLocation").is(":checked")){const a=f.getLatLng();window.boatCoordinates.lat=a.lat,window.boatCoordinates.lon=a.lng,c.append("boat_coordinates",JSON.stringify(window.boatCoordinates))}const e=b.attr("action");$.ajax({type:"POST",data:c,url:e,processData:!1,contentType:!1,success:function(a){hideOverlayPanel(),window.location.href=a.redirect},error:function(a){hideOverlayPanel(),showErrorToast(parseJSONError(a.responseJSON))}})}),$("#addressMapModal").on("shown.bs.modal",function(){var b=[55.75524,37.62896];$.isEmptyObject(f)||(b=f.getLatLng()),d=L.map("map",{dragging:!0}).setView(b,12),$.isEmptyObject(f)||f.addTo(d),d.on("click",function(b){a(b.latlng),c(b.latlng)}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"}).addTo(d)}),$("#addressMapModal").on("hidden.bs.modal",function(){d.remove(),d=null}),$("#switchCustomLocation").on("click",function(a){$(this).is(":checked")?($("#baseSelect").attr("disabled",!0),$("#collapseBase").collapse("hide"),$("#collapseCustomAddress").collapse("show"),a?.originalEvent?.isTrusted&&$("#btnShowAddressMapModal").click()):($("#collapseBase").collapse("show"),$("#collapseCustomAddress").collapse("hide"),$("#baseSelect").attr("disabled",!1))}),$("#btnAddTerm").on("click",function(){const a=$(this).attr("data-action");//const params = 'scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no';
window.open(a,"addTerm")}),$("#addressMapModalSearchButton").on("click",function(){console.log("click");const a=$("#addressMapModalSearchText").val();return a?void b(a):void showErrorToast("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441")}),$("#addressMapModalSearchText").on("keydown",function(a){if(13===a.keyCode){a.preventDefault();const b=$("#addressMapModalSearchButton");return b.focus(),b.click(),!1}}),window.isCustomLocation){var i={lat:window.boatCoordinates.lat,lng:window.boatCoordinates.lon};a(i),$(".addressLabel").text(window.boatCoordinates.address),$(".addressLabel").addClass("text-primary"),$("#switchCustomLocation").trigger("click")}var j,k});