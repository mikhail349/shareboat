function onAfterPopupClosed(a,b){a.close(),$("select[name=\"term\"]").append(new Option(text=b.name,value=b.pk,defaultSelected=!0,selected=!0))}$(document).ready(()=>{function a(a){c?.removeLayer(d),d=new L.marker(a,{draggable:!0,icon:window.markerIcon}).on("dragend",function(a){b(a.target.getLatLng())}),c&&d?.addTo(c)}function b(a){function b(){$("form button[type=submit").attr("disabled",!1),c?.removeLayer(d),d=null}$("form button[type=submit").attr("disabled",!0),$(".addressLabel").text("\u0418\u0434\u0435\u0442 \u043F\u043E\u0438\u0441\u043A..."),$(".addressLabel").removeClass("text-primary"),$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/reverse?lat=${a.lat}&lon=${a.lng}&format=json&accept-language=ru`,success:function b(a){a.display_name&&($(".addressLabel").text(a.display_name),$(".addressLabel").addClass("text-primary"),window.boatCoordinates.address=a.display_name,window.boatCoordinates.state=a?.address?.state,console.log(window.boatCoordinates),$("form button[type=submit").attr("disabled",!1))},error:b})}var c,d={};const e=$("#manufacturerSelect"),f=$("#modelSelect");if(e.on("change",function(a){f.html("<option selected disabled value=\"\">\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430</option>");const b=parseInt($("#manufacturerSelect option:selected").val());isNaN(b)||$.ajax({type:"GET",url:`/boats/api/get_models/${b}/`,success:a=>{for(let b of a.data)f.append(`
                        <option value="${b.id}">${b.name}</option>
                    `)}})}),$("#typeSelect").on("change",a=>{const b=parseInt($("#typeSelect option:selected").val()),c=$("#collapseMotorBoat"),d=c.find("fieldset");window.motorBoatTypes.includes(b)?(c.collapse("show"),d.removeAttr("disabled")):(c.collapse("hide"),d.attr("disabled",""));const e=$("#collapseComfortBoat"),f=e.find("fieldset");window.comfortBoatTypes.includes(b)?(e.collapse("show"),f.removeAttr("disabled")):(e.collapse("hide"),f.attr("disabled",""))}),$("form").on("submit",async a=>{function b(a){hideOverlayPanel(),window.location.href=a.redirect}function c(a){hideOverlayPanel(),showErrorToast(parseJSONError(a.responseJSON))}a.preventDefault();const e=$("form");if(!e.checkValidity())return;if($("#switchCustomLocation").is(":checked")&&$.isEmptyObject(d))return void showErrorToast("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441");showOverlayPanel();const f=new FormData(e[0]),g=$(".file-upload-wrapper img.card-img");for(let b of g){const a=$(b),c=a.attr("src"),d=a.attr("data-filename"),e=await fetch(c),g=await e.blob();d?f.append("file",g,d):f.append("file",g)}if(f.append("prices",JSON.stringify(window.prices)),$("#switchCustomLocation").is(":checked")){const a=d.getLatLng();window.boatCoordinates.lat=a.lat,window.boatCoordinates.lon=a.lng,f.append("boat_coordinates",JSON.stringify(window.boatCoordinates))}const h=e.attr("action");$.ajax({type:"POST",data:f,url:h,processData:!1,contentType:!1,success:b,error:c})}),$("#addressMapModal").on("shown.bs.modal",function(f){var e=[55.75524,37.62896];$.isEmptyObject(d)||(e=d.getLatLng()),c=L.map("map",{dragging:!0}).setView(e,12),$.isEmptyObject(d)||d.addTo(c),c.on("click",function(c){a(c.latlng),b(c.latlng)}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"}).addTo(c)}),$("#addressMapModal").on("hidden.bs.modal",function(a){c.remove(),c=null}),$("#switchCustomLocation").on("click",function(a){$(this).is(":checked")?($("#baseSelect").attr("disabled",!0),$("#collapseBase").collapse("hide"),$("#collapseCustomAddress").collapse("show"),a?.originalEvent?.isTrusted&&$("#btnShowAddressMapModal").click()):($("#collapseBase").collapse("show"),$("#collapseCustomAddress").collapse("hide"),$("#baseSelect").attr("disabled",!1))}),$("#btnAddTerm").on("click",function(){const a=$(this).attr("data-action");//const params = 'scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no';
window.open(a,"addTerm")}),window.isCustomLocation){var g={lat:window.boatCoordinates.lat,lng:window.boatCoordinates.lon};a(g),$(".addressLabel").text(window.boatCoordinates.address),$(".addressLabel").addClass("text-primary"),$("#switchCustomLocation").trigger("click")}});