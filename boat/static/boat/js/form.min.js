$(document).ready(()=>{function a(a){c?.removeLayer(d),d=new L.marker(a,{draggable:!0,icon:window.markerIcon}).on("dragend",function(a){b(a.target.getLatLng())}),c&&d?.addTo(c)}function b(a){function b(){$("form button[type=submit").attr("disabled",!1),c?.removeLayer(d),d=null}$("form button[type=submit").attr("disabled",!0),$(".addressLabel").text("\u0418\u0434\u0435\u0442 \u043F\u043E\u0438\u0441\u043A..."),$(".addressLabel").removeClass("text-primary"),$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/reverse?lat=${a.lat}&lon=${a.lng}&format=json&accept-language=ru`,success:function(a){a.display_name&&($(".addressLabel").text(a.display_name),$(".addressLabel").addClass("text-primary"),window.boatCoordinates.address=a.display_name,window.boatCoordinates.state=a?.address?.state,$("form button[type=submit").attr("disabled",!1))},error:b})}var c,d={};if($("#typeSelect").on("change",()=>{const a=parseInt($("#typeSelect option:selected").val()),b=$("#collapseMotorBoat"),c=b.find("fieldset");window.motorBoatTypes.includes(a)?(b.collapse("show"),c.removeAttr("disabled")):(b.collapse("hide"),c.attr("disabled",""));const d=$("#collapseComfortBoat"),e=d.find("fieldset");window.comfortBoatTypes.includes(a)?(d.collapse("show"),e.removeAttr("disabled")):(d.collapse("hide"),e.attr("disabled",""))}),$("form").on("submit",async a=>{a.preventDefault();const b=$("form");if(!b.checkValidity())return;if($("#switchCustomLocation").is(":checked")&&$.isEmptyObject(d))return void showErrorToast("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441");showOverlayPanel();const c=new FormData(b[0]),e=$(".file-upload-wrapper img.card-img");for(let b of e){const a=$(b),d=a.attr("src"),e=a.attr("data-filename"),f=await fetch(d),g=await f.blob();e?c.append("file",g,e):c.append("file",g)}if(c.append("prices",JSON.stringify(window.prices)),$("#switchCustomLocation").is(":checked")){const a=d.getLatLng();window.boatCoordinates.lat=a.lat,window.boatCoordinates.lon=a.lng,c.append("boat_coordinates",JSON.stringify(window.boatCoordinates))}const f=b.attr("action");$.ajax({type:"POST",data:c,url:f,processData:!1,contentType:!1,success:function(a){hideOverlayPanel(),window.location.href=a.redirect},error:function(a){hideOverlayPanel(),showErrorToast(parseJSONError(a.responseJSON))}})}),$("#addressMapModal").on("shown.bs.modal",function(){var e=[55.75524,37.62896];$.isEmptyObject(d)||(e=d.getLatLng()),c=L.map("map",{dragging:!0}).setView(e,12),$.isEmptyObject(d)||d.addTo(c),c.on("click",function(c){a(c.latlng),b(c.latlng)}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"}).addTo(c)}),$("#addressMapModal").on("hidden.bs.modal",function(){c.remove(),c=null}),$("#switchCustomLocation").on("click",function(){$(this).is(":checked")?($("#baseSelect").attr("disabled",!0),$("#collapseBase").collapse("hide"),$("#collapseCustomAddress").collapse("show")):($("#collapseBase").collapse("show"),$("#collapseCustomAddress").collapse("hide"),$("#baseSelect").attr("disabled",!1))}),window.isCustomLocation){var e={lat:window.boatCoordinates.lat,lng:window.boatCoordinates.lon};a(e),$(".addressLabel").text(window.boatCoordinates.address),$(".addressLabel").addClass("text-primary"),$("#switchCustomLocation").trigger("click")}});