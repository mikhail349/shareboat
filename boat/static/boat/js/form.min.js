function onAfterPopupClosed(a,b){a.close(),$("select[name=\"term\"]").append(new Option(text=b.name,value=b.pk,defaultSelected=!0,selected=!0))}$(document).ready(()=>{function a(a){d?.removeLayer(f),f=new L.marker(a,{draggable:!0,icon:window.markerIcon}).on("dragend",function(a){c(a.target.getLatLng())}),d&&f?.addTo(d)}function b(b){$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/?q=${b}&format=json&accept-language=ru`,success:function e(b){if(0==b.length)return showErrorToast("\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E");const f=b[0];var g={lat:f.lat,lng:f.lon};d.setView(g),a(g),c(g)}})}function c(a){function b(a){a.display_name&&($(".addressLabel").text(a.display_name),$(".addressLabel").addClass("text-primary"),window.boatCoordinates.address=a.display_name,window.boatCoordinates.state=a?.address?.state,$("form button[type=submit").attr("disabled",!1))}function c(){$("form button[type=submit").attr("disabled",!1),d?.removeLayer(f),f=null}$("form button[type=submit").attr("disabled",!0),$(".addressLabel").text("\u0418\u0434\u0435\u0442 \u043F\u043E\u0438\u0441\u043A..."),$(".addressLabel").removeClass("text-primary"),$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/reverse?lat=${a.lat}&lon=${a.lng}&format=json&accept-language=ru`,success:b,error:c})}var d,f={};const g=$("#manufacturerSelect"),h=$("#modelSelect");if(g.on("change",function(a){h.html("<option selected disabled value=\"\">\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043F\u0438\u0441\u043A\u0430</option>");const b=parseInt($("#manufacturerSelect option:selected").val());isNaN(b)||$.ajax({type:"GET",url:`/boats/api/get_models/${b}/`,success:a=>{for(let b of a.data)h.append(`
                        <option value="${b.id}">${b.name}</option>
                    `)}})}),$("#typeSelect").on("change",a=>{const b=parseInt($("#typeSelect option:selected").val()),c=$("#collapseMotorBoat"),d=c.find("fieldset");window.motorBoatTypes.includes(b)?(c.collapse("show"),d.removeAttr("disabled")):(c.collapse("hide"),d.attr("disabled",""));const e=$("#collapseComfortBoat"),f=e.find("fieldset");window.comfortBoatTypes.includes(b)?(e.collapse("show"),f.removeAttr("disabled")):(e.collapse("hide"),f.attr("disabled",""))}),$("form").on("submit",async a=>{function b(a){hideOverlayPanel(),window.location.href=a.redirect}function c(a){hideOverlayPanel(),showErrorToast(parseJSONError(a.responseJSON))}a.preventDefault();const d=$("form");if(!d.checkValidity())return;if($("#switchCustomLocation").is(":checked")&&$.isEmptyObject(f))return void showErrorToast("\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441");showOverlayPanel();const e=new FormData(d[0]),g=$(".file-upload-wrapper img.card-img");for(let b of g){const a=$(b),c=a.attr("src"),d=a.attr("data-filename"),f=await fetch(c),g=await f.blob();d?e.append("file",g,d):e.append("file",g)}if(e.append("prices",JSON.stringify(window.prices)),$("#switchCustomLocation").is(":checked")){const a=f.getLatLng();window.boatCoordinates.lat=a.lat,window.boatCoordinates.lon=a.lng,e.append("boat_coordinates",JSON.stringify(window.boatCoordinates))}const h=d.attr("action");$.ajax({type:"POST",data:e,url:h,processData:!1,contentType:!1,success:b,error:c})}),$("#addressMapModal").on("shown.bs.modal",function(b){var e=[55.75524,37.62896];$.isEmptyObject(f)||(e=f.getLatLng()),d=L.map("map",{dragging:!0}).setView(e,12),$.isEmptyObject(f)||f.addTo(d),d.on("click",function(b){a(b.latlng),c(b.latlng)}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"}).addTo(d)}),$("#addressMapModal").on("hidden.bs.modal",function(a){d.remove(),d=null}),$("#switchCustomLocation").on("click",function(a){$(this).is(":checked")?($("#baseSelect").attr("disabled",!0),$("#collapseBase").collapse("hide"),$("#collapseCustomAddress").collapse("show"),a?.originalEvent?.isTrusted&&$("#btnShowAddressMapModal").click()):($("#collapseBase").collapse("show"),$("#collapseCustomAddress").collapse("hide"),$("#baseSelect").attr("disabled",!1))}),$("#btnAddTerm").on("click",function(){const a=$(this).attr("data-action");//const params = 'scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no';
window.open(a,"addTerm")}),$("#addressMapModalSearchButton").on("click",function(a){const c=$("#addressMapModalSearchText").val();return c?void b(c):void showErrorToast("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441")}),$(document).on("keydown","#addressMapModalSearchText",function(a){var b=a.keyCode||a.which;13==b&&a.preventDefault()}),$(document).on("keyup","#addressMapModalSearchText",function(a){var b=a.keyCode||a.which;if(13==b){a.preventDefault();const b=$("#addressMapModalSearchButton");b.focus(),b.click()}}),window.isCustomLocation){var i={lat:window.boatCoordinates.lat,lng:window.boatCoordinates.lon};a(i),$(".addressLabel").text(window.boatCoordinates.address),$(".addressLabel").addClass("text-primary"),$("#switchCustomLocation").trigger("click")}});