$(document).ready(()=>{function a(a){$("#addressInput").val("\u0418\u0434\u0435\u0442 \u043F\u043E\u0438\u0441\u043A..."),$("#addressInput").attr("disabled",!0),$.ajax({type:"GET",url:`https://nominatim.openstreetmap.org/reverse?lat=${a.lat}&lon=${a.lng}&format=json&accept-language=ru`,success:function(a){a.display_name&&($("#addressInput").val(a.display_name),$("#addressInput").attr("disabled",!1))}})}$("#typeSelect").on("change",()=>{const a=parseInt($("#typeSelect option:selected").val()),b=$("#collapseMotorBoat"),c=b.find("fieldset");window.motorBoatTypes.includes(a)?(b.collapse("show"),c.removeAttr("disabled")):(b.collapse("hide"),c.attr("disabled",""));const d=$("#collapseComfortBoat"),e=d.find("fieldset");window.comfortBoatTypes.includes(a)?(d.collapse("show"),e.removeAttr("disabled")):(d.collapse("hide"),e.attr("disabled",""))}),$("form").on("submit",async a=>{a.preventDefault();const b=$("form");if(!b.checkValidity())return;showOverlayPanel();const c=new FormData(b[0]),d=$(".file-upload-wrapper img.card-img");for(let b of d){const a=$(b),d=a.attr("src"),e=a.attr("data-filename"),f=await fetch(d),g=await f.blob();e?c.append("file",g,e):c.append("file",g)}c.append("prices",JSON.stringify(window.prices));const e=b.attr("action");$.ajax({type:"POST",data:c,url:e,processData:!1,contentType:!1,success:function(a){hideOverlayPanel(),window.location.href=a.redirect},error:function(a){hideOverlayPanel(),showErrorToast(parseJSONError(a.responseJSON))}})});var b,c={};$("#switchCustomLocation").on("click",function(){$(this).is(":checked")?($("#mapContainer").show(),b=L.map("map",{/*dragging: !L.Browser.mobile*/}).setView([55.72524,37.62896],12),b.on("click",function(d){var e=L.icon({iconUrl:markerIconUrl,shadowUrl:markerShadowUrl,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});b?.removeLayer(c),c=new L.marker(d.latlng,{draggable:!0,icon:e}).on("dragend",function(b){//map?.removeLayer(marker);
console.log("dragend",b.target.getLatLng()),a(b.target.getLatLng())}).addTo(b),a(d.latlng)}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:"&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"}).addTo(b)):($("#mapContainer").hide(),b?.remove())})});