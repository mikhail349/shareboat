$(document).ready(()=>{function a(){const a=$("#bookingdaterangepicker").data("daterangepicker");var c=a.startDate.format(a.locale.format)+" - "+a.endDate.format(a.locale.format);window.selectedStartDate=a.startDate,window.selectedEndDate=a.endDate,window.totalSum=null,!b||b.abort(),b=$.ajax({type:"GET",url:`/boats/api/calc_booking/${boatId}/?start_date=${a.startDate.format("YYYY-MM-DD")}&end_date=${a.endDate.format("YYYY-MM-DD")}`,processData:!1,contentType:!1,success:function(a){$("#bookingdaterangepicker").val(c),window.totalSum=a.sum,$("#priceAlert").removeClass("alert-danger"),$("#priceAlert").removeClass("alert-secondary"),$("#priceAlert").addClass("alert-success");let b=a.sum.toLocaleString("ru-RU",{style:"currency",currency:"RUB"}),d=plural(a.days,"\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439");$("#priceAlert").html(`
                <strong>${b}</strong><span> за ${a.days} ${d}</span>
            `)},error:function(a){window.selectedStartDate=null,window.selectedEndDate=null,window.totalSum=null;0==a.status||($("#bookingdaterangepicker").val(""),$("#priceAlert").removeClass("alert-success"),$("#priceAlert").removeClass("alert-secondary"),$("#priceAlert").addClass("alert-danger"),$("#priceAlert").html(`
                <h5>${parseJSONError(a.responseJSON)}</h5>
            `))}}),$("#priceAlert").removeClass("alert-danger"),$("#priceAlert").removeClass("alert-success"),$("#priceAlert").addClass("alert-secondary"),$("#priceAlert").html(`
            <strong>Идет расчет цены...</strong>
        `)}$("#bookingdaterangepicker").daterangepicker({format:"DD.MM.YYYY",drops:"up",autoUpdateInput:!1,minDate:new Date(Math.max.apply(null,[firstPriceDate,new Date])),maxDate:lastPriceDate,isInvalidDate:function(a){for(let b of acceptedBookingsRanges)if(a._d>=b.startDate&&a._d<=b.endDate)return!0;for(let b of priceRanges)if(a._d>=b.startDate&&a._d<=b.endDate)return!1;return!0},locale:{format:"DD.MM.YYYY",applyLabel:"\u041E\u043A",cancelLabel:"\u041E\u0442\u043C\u0435\u043D\u0430",fromLabel:"\u041E\u0442",toLabel:"\u0414\u043E",customRangeLabel:"\u041F\u0440\u043E\u0438\u0437\u0432\u043E\u043B\u044C\u043D\u044B\u0439",daysOfWeek:["\u0412\u0441","\u041F\u043D","\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041F\u0442","\u0421\u0431"],monthNames:["\u042F\u043D\u0432\u0430\u0440\u044C","\u0424\u0435\u0432\u0440\u0430\u043B\u044C","\u041C\u0430\u0440\u0442","\u0410\u043F\u0440\u0435\u043B\u044C","\u041C\u0430\u0439","\u0418\u044E\u043D\u044C","\u0418\u044E\u043B\u044C","\u0410\u0432\u0433\u0443\u0441\u0442","\u0421\u0435\u043D\u0442\u044F\u0431\u0440\u044C","\u041E\u043A\u0442\u044F\u0431\u0440\u044C","\u041D\u043E\u044F\u0431\u0440\u044C","\u0414\u0435\u043A\u0430\u0431\u0440\u044C"],firstDay:1}});var b=null,b=null;$("#bookingdaterangepicker").on("apply.daterangepicker",function(){a()}),$("form").on("submit",function(b){b.preventDefault();const c=$("#bookingdaterangepicker");if(c.removeAttr("readonly"),!$(this).checkValidity())return;showOverlayPanel("\u0411\u0440\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435...");const d=$(this).attr("action"),e=new FormData;e.append("start_date",window.selectedStartDate.format("YYYY-MM-DD")),e.append("end_date",window.selectedEndDate.format("YYYY-MM-DD")),e.append("total_sum",window.totalSum),e.append("boat_id",window.boatId),$.ajax({type:"POST",url:d,data:e,processData:!1,contentType:!1,success:function(){c.attr("readonly",!0),hideOverlayPanel()},error:function(b){c.attr("readonly",!0),hideOverlayPanel(),showErrorToast(b.responseJSON.message),"outdated_price"===b.responseJSON?.code&&a()}})})});