$(document).ready(()=>{function a(){2!==d.selectedDates.length||(window.selectedStartDate=d.selectedDates[0],window.selectedEndDate=d.selectedDates[1],window.totalSum=null,!!e&&e.abort(),e=$.ajax({type:"GET",url:`/boats/api/calc_booking/${boatId}/?start_date=${toJSONLocal(d.selectedDates[0])}&end_date=${toJSONLocal(d.selectedDates[1])}`,processData:!1,contentType:!1,success:function(a){window.totalSum=a.sum,$("#priceAlert").removeClass("alert-danger"),$("#priceAlert").removeClass("alert-secondary"),$("#priceAlert").addClass("alert-success");let b=a.sum.toLocaleString("ru-RU",{style:"currency",currency:"RUB"}),c=plural(a.days,"\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439");$("#priceAlert").html(`
                <strong>${b}</strong><span> за ${a.days} ${c}</span>
            `)},error:function(a){window.selectedStartDate=null,window.selectedEndDate=null,window.totalSum=null;0==a.status||($("#priceAlert").removeClass("alert-success"),$("#priceAlert").removeClass("alert-secondary"),$("#priceAlert").addClass("alert-danger"),$("#priceAlert").html(`
                <h5>${parseJSONError(a.responseJSON)}</h5>
            `))}}),$("#priceAlert").removeClass("alert-danger"),$("#priceAlert").removeClass("alert-success"),$("#priceAlert").addClass("alert-secondary"),$("#priceAlert").html(`
            <strong>Идет расчет цены...</strong>
        `))}const b=new URLSearchParams(window.location.search),c=b.has("dateFrom")&&b.has("dateTo"),d=new AirDatepicker("#dateRange",{selectedDates:[c?new Date(b.get("dateFrom")):void 0,c?new Date(b.get("dateTo")):void 0],autoClose:!0,range:!0,minDate:new Date(Math.max.apply(null,[firstPriceDate,new Date])),maxDate:lastPriceDate,multipleDatesSeparator:" - ",position:"top left",onHide:b=>{b&&a()},onRenderCell:({date:a})=>{for(let b of acceptedBookingsRanges)if(a>=b.startDate&&a<=b.endDate)return{disabled:!0};for(let b of priceRanges)if(a>=b.startDate&&a<=b.endDate)return{disabled:!1};return{disabled:!0}}});c&&a();var e=null,e=null;$("form").on("submit",function(b){if(b.preventDefault(),!$(this).checkValidity(!1))return;showOverlayPanel("\u0411\u0440\u043E\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435...");const c=$(this).attr("action"),d=new FormData;d.append("start_date",toJSONLocal(window.selectedStartDate)),d.append("end_date",toJSONLocal(window.selectedEndDate)),d.append("total_sum",window.totalSum),d.append("boat_id",window.boatId),$.ajax({type:"POST",url:c,data:d,processData:!1,contentType:!1,success:function(a){hideOverlayPanel(),window.location.href=a.redirect},error:function(b){hideOverlayPanel(),showErrorToast(b.responseJSON.message),"outdated_price"===b.responseJSON?.code&&a()}})})});